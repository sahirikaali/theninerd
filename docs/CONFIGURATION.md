# Configuration

## GitHub Secrets (3 required)

Set these in **Settings > Secrets and variables > Actions > Secrets**:

| Secret | Description | Required |
|--------|-------------|----------|
| `GH_PAT` | GitHub Classic PAT with `repo` + `workflow` scopes | Yes |
| `NVIDIA_API_KEY` | NVIDIA NIM API key (get at [build.nvidia.com](https://build.nvidia.com)) | Yes |
| `TELEGRAM_BOT_TOKEN` | Telegram bot token from @BotFather | Yes |
| `TELEGRAM_CHAT_ID` | Your Telegram chat ID (see below) | After first run |
| `LLM_SECRETS` | Base64 JSON with agent-accessible credentials | No |

All other credentials (`API_KEY`, `GH_WEBHOOK_SECRET`, `TELEGRAM_WEBHOOK_SECRET`, `SECRETS` JSON, `.env` file) are **auto-generated at runtime** by the workflows from these secrets.

---

## GitHub Repository Variables

Configure in **Settings > Secrets and variables > Actions > Variables**:

| Variable | Description | Required | Default |
|----------|-------------|----------|---------|
| `GH_WEBHOOK_URL` | Event handler public URL (auto-set by `event-handler.yml`) | Auto | -- |
| `AUTO_MERGE` | Set to `false` to disable auto-merge of job PRs | No | Enabled |
| `ALLOWED_PATHS` | Comma-separated path prefixes for auto-merge | No | `/logs` |
| `IMAGE_URL` | Docker image path (e.g., `ghcr.io/myorg/mybot`) | No | `stephengpope/thepopebot:latest` |
| `MODEL` | NVIDIA model ID for the Pi agent | No | `moonshotai/kimi-k2.5` |

---

## Event Handler Environment Variables

These are auto-generated by `event-handler.yml` at runtime. Listed here for local development reference:

| Variable | Description | Source |
|----------|-------------|--------|
| `API_KEY` | Auth key for /webhook endpoint | Derived from `GH_PAT` |
| `GH_TOKEN` | GitHub PAT for creating branches/files | From `GH_PAT` secret |
| `GH_OWNER` | GitHub repository owner | From `github.repository` |
| `GH_REPO` | GitHub repository name | From `github.repository` |
| `GH_WEBHOOK_SECRET` | GitHub Actions webhook auth | Derived from `GH_PAT` |
| `TELEGRAM_BOT_TOKEN` | Telegram bot token | From secret |
| `TELEGRAM_WEBHOOK_SECRET` | Telegram webhook validation | Derived from `GH_PAT` |
| `TELEGRAM_CHAT_ID` | Restricts bot to this chat | From secret |
| `NVIDIA_API_KEY` | NVIDIA NIM API key | From secret |
| `PORT` | Server port (default: 3000) | Hardcoded |
| `EVENT_HANDLER_MODEL` | Chat model (default: `moonshotai/kimi-k2.5`) | Optional |

---

## Telegram Setup

### Automatic Webhook Registration

The `event-handler.yml` workflow automatically registers your Telegram webhook on startup. No manual `curl` commands needed.

### Get Your Chat ID

1. Message **@userinfobot** on Telegram â€” it replies with your user/chat ID
2. Set `TELEGRAM_CHAT_ID` as a GitHub Secret with that number
3. Re-trigger the event handler workflow

Now your bot only responds to your authorized chat.
